<link rel="import" href="../../bower_components/polymer/polymer.html"><link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html"><link rel="import" href="../../bower_components/iron-behaviors/iron-button-state.html"><link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html"><link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html"><link rel="import" href="../cr-search-menu/cr-search-menu.html"><dom-module id="cr-search-control"><template><style>:host {
        display: block;
      }
      :host([input-active]) {
        @apply --layout-horizontal;
        @apply --layout-center;
      }
      :host([input-active]) paper-icon-button {
        @apply --layout-flex-none;
        color: black;
      }
      :host([input-active]) #search-input-container {
        @apply --layout-flex;
        @apply --layout-horizontal;
      }
      input[type="search"] {
        -webkit-appearance: textfield;
        display: inline-block;
        font-size: 24px;
        font-weight: 200;
        font-family: Roboto;
        background-color: #3F51B5;
        border-style: none;
        color: white;
        width: 100%;
        @apply --layout-flex;
        border-bottom: 1px solid transparent;
        border-radius: 0;
      }
      input:focus {
        transition: border-color 0.4s ease;
        border-bottom: 1px solid #4BBDA8;
        outline: none;
      }</style><iron-ajax id="ajax" auto="" url="{{protocolSrc}}" handle-as="json" active-requests="{{requests}}" last-response="{{ajaxResponse}}"></iron-ajax><paper-icon-button id="searchButton" toggles="" icon="search" on-active-changed="handleButtonActiveChange_"></paper-icon-button><div id="search-input-container" hidden$="{{!inputActive}}"><input id="input" value="{{searchText::input}}" autocapitalize="off" autocorrect="off" placeholder="Search..." type="search"></div></template></dom-module><script>(function(){var a={keys:null,index:null,prevKey_:null,prevMatches_:null,getMatches:function(a){if(!a)return[];var b=!1;if(this.prevKey_){var c=a.indexOf(this.prevKey_);0===c&&(b=!0)}var d;if(b)d=this.prevMatches_.filter(function(b){return-1!==b.indexOf(a)});else{var e=[],f=[];this.keys.forEach(function(b){var c=b.indexOf(a);0===c?e.push(b):-1!==c&&f.push(b)}),d=e.concat(f)}return this.prevKey_=a,this.prevMatches_=d,d.map(function(a){return this.index[a]},this)},createKeywordsModel:function(b){var c=Object.create(a);return c.keys=Object.keys(b),c.index=b,c}};Polymer({is:'cr-search-control',behaviors:[Polymer.IronButtonState],properties:{protocolSrc:{value:String},inputActive:{type:Boolean,value:!1,notify:!0,reflectToAttribute:!0,observer:'handleInputActive_'},searchText:{type:String,reflectToAttribute:!0,notify:!0,value:'',observer:'handleSearchChange_'},requests:{type:Array,value:function(){return[]}},ajaxResponse:{type:Object,observer:'handleAjaxResponse_'},resultsMenu:{type:HTMLElement}},keyBindings:{esc:'handleEsc_',enter:'handleEnter_',up:'handleUpArrow_',down:'handleDownArrow_'},listeners:{"input.blur":'handleBlur_'},setMenuOpen_:function(a){this.fire('search-menu-selected',{open:a})},handleEnter_:function(){this.resultsMenu.chooseHighlightedResult()},handleUpArrow_:function(){this.resultsMenu.highlightPreviousResult()},handleDownArrow_:function(){this.resultsMenu.highlightNextResult()},handleSearchChange_:function(){this.inputActive&&this.debounce('inputChange',function(){this.resultsMenu.searchString=this.searchText,this.setMenuOpen_(!!this.searchText)}.bind(this),70)},handleEsc_:function(){this.resultsMenu.opened?this.setMenuOpen_(!1):this.inputActive=!1},handleButtonActiveChange_:function(){this.inputActive=this.$.searchButton.active},handleInputActive_:function(){this.inputActive?this.async(function(){this.$.input.focus(),this.handleSearchChange_(),this.$.searchButton.icon='icons:arrow-forward'}.bind(this),50):(this.$.searchButton.icon='search',this.$.searchButton.active=!1),this.fire(this.inputActive?'active':'inactive')},handleAjaxResponse_:function(){this.resultsMenu.keywordsModel=a.createKeywordsModel(this.ajaxResponse)},handleItemActivate_:function(){this.setMenuOpen_(!1),this.inputActive=!1},handleBlur_:function(){this.resultsMenu.opened||(this.$.searchButton.active=!1)}})})();</script>